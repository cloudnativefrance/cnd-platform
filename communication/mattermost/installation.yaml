apiVersion: installation.mattermost.com/v1beta1
kind: Mattermost
metadata:
  name: cnd-france
spec:
  version: 10.8.1
  ingress:
    enabled: true
    host: mm.cloudnativedays.fr
    ingressClass: public
    tlsSecret: "mattermost-tls"
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt
      nginx.ingress.kubernetes.io/proxy-body-size: "100m"
      nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
      nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      # WebSocket-specific configuration
      nginx.ingress.kubernetes.io/proxy-http-version: "1.1"
      nginx.ingress.kubernetes.io/configuration-snippet: |
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Real-IP $remote_addr;
  database:
    external:
      secret: mattermost-cnpg-secret
  fileStore:
    external:
      url: storage.googleapis.com
      bucket: cloudnativedaysfr
      secret: cnd-france-gcs-secret
  scheduling:
    resources:
      requests:
        cpu: 300m
        memory: 300Mi
      limits:
        memory: 300Mi
